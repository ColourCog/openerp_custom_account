<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

    <!-- Invoice import button-->
    <record id="view_loan_import_invoice" model="ir.ui.view">
        <field name="name">hr.loan.import.invoice</field>
        <field name="model">hr.loan</field>
        <field name="inherit_id" ref="hr_loan.view_hr_loan_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='validate']" position="after">
                <button 
                    name="loan_invoice" 
                    type="object" 
                    string="Import Invoice" 
                    states="draft" 
                    class="oe_highlight" 
                    context="{'employee_id':employee_id}"
                    groups="account.group_account_invoice"/>
            </xpath>
        </field>
    </record>

    <!-- Wizard -->
    <record id="hr_loan_invoice_view" model="ir.ui.view">
        <field name="name">hr.loan.invoice.form</field>
        <field name="model">hr.loan.invoice</field>
        <field name="arch" type="xml">
            <form string="Import Invoice" version="7.0">
                <p>Use invoice as basis for a loan</p>
                <group>
                  <field name="partner_id" />
                  <field name="invoice_id" 
                    domain="[('partner_id', '=', partner_id), ('state', '=', 'open')]" 
                    on_change="onchange_invoice(invoice_id)" />
                  <field name="amount" />
                  <field name="nb_payments" on_change="onchange_nb_payments(amount, nb_payments)" />
                  <field name="installment"/>
                  <field name="paymethod_id" domain="[('type', 'in', ['cash','bank'])]"/>
                </group>
                <footer>
                    <button string="Import" name="import_loan" type="object" default_focus="1" class="oe_highlight"/>
                    or
                    <button string="Cancel" class="oe_link" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>


  </data>
</openerp>
